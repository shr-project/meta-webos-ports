From e1f634737683464eef3c1dacc0670cb5149355f6 Mon Sep 17 00:00:00 2001
From: Martin Jansa <martin.jansa@gmail.com>
Date: Fri, 5 Apr 2024 13:43:54 +0200
Subject: [PATCH] mediaitem.cpp: Fix build with gcc-14

* fixes:
| FAILED: src/CMakeFiles/com.webos.service.mediaindexer.dir/mediaitem.cpp.o
| /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot-native/usr/bin/x86_64-webos-linux/x86_64-webos-linux-g++ --sysroot=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot -DCACHE_DIRECTORY=\"/media/.cache/\" -DCACHE_JSONFILE=\"cache.json\" -DHAS_GSTREAMER -DHAS_LUNA -DHAS_PMLOG -DHAS_TAGLIB -DJSON_CONFIGURATION_FILE=\"/etc/com.webos.service.mediaindexer/com.webos.service.mediaindexer.conf\" -DLOGGING_THREAD_ID -DPARALLEL_META_EXTRACTION=10 -DPERFCHECK_ENABLE=1 -DTHUMBNAIL_DIRECTORY=\"/media/.thumbnail/\" -DTHUMBNAIL_EXTENSION=\".jpg\" -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/glib-2.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/lib/glib-2.0/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/taglib -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/gstreamer-1.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/orc-0.4 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/. -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/./jsonparser -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/./log -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/./mediaindexerclient -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/./perf -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/./cache -m64 -march=nehalem -mtune=generic -mfpmath=sse -msse4.2  --sysroot=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot  -O2 -pipe -g -feliminate-unused-debug-types -fcanon-prefix-map  -fmacro-prefix-map=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git=/usr/src/debug/com.webos.service.mediaindexer/1.0.0-25  -fdebug-prefix-map=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git=/usr/src/debug/com.webos.service.mediaindexer/1.0.0-25  -fmacro-prefix-map=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/build=/usr/src/debug/com.webos.service.mediaindexer/1.0.0-25  -fdebug-prefix-map=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/build=/usr/src/debug/com.webos.service.mediaindexer/1.0.0-25  -fdebug-prefix-map=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot=  -fmacro-prefix-map=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot=  -fdebug-prefix-map=/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot-native=  -fvisibility-inlines-hidden -std=c++17 -Wall -Wextra -fno-permissive -pthread -Wno-unused-parameter -Wno-deprecated-declarations -Wno-type-limits -Wno-comment -Werror=return-type -Werror=reorder -Werror=uninitialized -fPIC -Wl,--no-undefined -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/glib-2.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/lib/glib-2.0/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -DUSE_PMLOG_DECLARATION -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/glib-2.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/lib/glib-2.0/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/taglib -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/glib-2.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/lib/glib-2.0/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -pthread -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/gstreamer-1.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/glib-2.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/lib/glib-2.0/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -pthread -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/gstreamer-1.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/orc-0.4 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/gstreamer-1.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/glib-2.0 -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/lib/glib-2.0/include -I/OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include -g -MD -MT src/CMakeFiles/com.webos.service.mediaindexer.dir/mediaitem.cpp.o -MF src/CMakeFiles/com.webos.service.mediaindexer.dir/mediaitem.cpp.o.d -o src/CMakeFiles/com.webos.service.mediaindexer.dir/mediaitem.cpp.o -c /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/mediaitem.cpp
| /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/mediaitem.cpp: In static member function 'static bool MediaItem::extTypeSupported(const std::string&)':
| /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/mediaitem.cpp:110:24: error: no matching function for call to 'find(std::vector<std::__cxx11::basic_string<char> >::iterator, std::vector<std::__cxx11::basic_string<char> >::iterator, const std::string&)'
|   110 |     auto it = std::find(notSupportedExt_.begin(), notSupportedExt_.end(), ext);
|       |               ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
| In file included from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/c++/14.0.1/bits/locale_facets.h:48,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/c++/14.0.1/bits/basic_ios.h:37,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/c++/14.0.1/ios:46,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/c++/14.0.1/ostream:40,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/c++/14.0.1/iostream:41,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/pbnjson/cxx/JValue.h:44,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/pbnjson.hpp:99,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/mediaitem.h:21,
|                  from /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/mediaitem.cpp:17:
| /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/mediaitem.cpp:110:24: error: no matching function for call to '
find(std::vector<std::__cxx11::basic_string<char> >::iterator, std::vector<std::__cxx11::basic_string<char> >::iterator, const std::string&)'
| /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/c++/14.0.1/bits/streambuf_iterator.h:435:5: note: candidate:
'template<class _CharT2> typename __gnu_cxx::__enable_if<std::__is_char<_CharT2>::__value, std::istreambuf_iterator<_CharT, std::char_traits<_CharT> > >::__type
std::find(istreambuf_iterator<_CharT, char_traits<_CharT> >, istreambuf_iterator<_CharT, char_traits<_CharT> >, const _CharT2&)'
|   435 |     find(istreambuf_iterator<_CharT> __first,
|       |     ^~~~
| /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/recipe-sysroot/usr/include/c++/14.0.1/bits/streambuf_iterator.h:435:5: note:   template argument deduction/substitution failed:
| /OE/build/luneos-styhead/tmp-glibc/work/corei7-64-webos-linux/com.webos.service.mediaindexer/1.0.0-25/git/src/mediaitem.cpp:110:24: note:
'__gnu_cxx::__normal_iterator<std::__cxx11::basic_string<char>*, std::vector<std::__cxx11::basic_string<char> > >'
is not derived from
'std::istreambuf_iterator<_CharT, std::char_traits<_CharT> >'
|   110 |     auto it = std::find(notSupportedExt_.begin(), notSupportedExt_.end(), ext);
|       |               ~~~~~~~~~^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
---
Upstream-Status: Pending

 src/mediaitem.cpp | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/mediaitem.cpp b/src/mediaitem.cpp
index adf7e24..348f361 100644
--- a/src/mediaitem.cpp
+++ b/src/mediaitem.cpp
@@ -20,6 +20,7 @@
 #include "plugins/plugin.h"
 #include <cinttypes>
 #include <gio/gio.h>
+#include <algorithm>
 #include <exception>
 #include <stdexcept>
 #include <fstream>
